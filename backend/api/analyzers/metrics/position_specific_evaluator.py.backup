"""
Position-Specific Player Evaluator
ì„¸ê³„ì ì¸ ê°ë… ìˆ˜ì¤€ì˜ í¬ì§€ì…˜ë³„ ì „ë¬¸ í‰ê°€ ì‹œìŠ¤í…œ

Based on philosophies of:
- Mourinho: Defensive solidity, tactical discipline
- Klopp: High-intensity pressing, transitions
- Guardiola: Build-up play, passing accuracy
"""
from typing import List, Dict, Any, Optional
import statistics


class PositionSpecificEvaluator:
    """
    ê° í¬ì§€ì…˜ì˜ ì—­í• ì— ë§ëŠ” ì „ë¬¸ì ì¸ í‰ê°€ ì‹œìŠ¤í…œ
    """

    # Nexon API Position Codes
    POSITION_CODES = {
        'GK': [0],
        'CB': [1, 4, 5, 6],  # SW, RCB, CB, LCB
        'FB': [3, 7],  # RB, LB
        'WB': [2, 8],  # RWB, LWB
        'CDM': [9, 10, 11],  # RDM, CDM, LDM
        'CM': [13, 14, 15],  # RCM, CM, LCM
        'CAM': [17, 18, 19],  # RAM, CAM, LAM
        'WM': [12, 16],  # RM, LM
        'W': [20, 22, 23, 27],  # RF, LF, RW, LW
        'ST': [21, 24, 25, 26],  # CF, RS, ST, LS
    }

    @classmethod
    def evaluate_player(cls,
                       player_stats: List[Dict[str, Any]],
                       position_code: int) -> Dict[str, Any]:
        """
        í¬ì§€ì…˜ë³„ ì „ë¬¸ í‰ê°€ ìˆ˜í–‰

        Args:
            player_stats: ì„ ìˆ˜ì˜ ìµœê·¼ ê²½ê¸° í†µê³„ ë¦¬ìŠ¤íŠ¸
            position_code: í¬ì§€ì…˜ ì½”ë“œ (0-27)

        Returns:
            í¬ì§€ì…˜ë³„ ìƒì„¸ í‰ê°€ ê²°ê³¼
        """
        if not player_stats:
            return cls._empty_evaluation()

        # í¬ì§€ì…˜ ê·¸ë£¹ ê²°ì •
        position_group = cls._get_position_group(position_code)

        # í¬ì§€ì…˜ë³„ í‰ê°€ ìˆ˜í–‰
        if position_group == 'GK':
            return cls._evaluate_goalkeeper(player_stats)
        elif position_group == 'CB':
            return cls._evaluate_center_back(player_stats)
        elif position_group in ['FB', 'WB']:
            return cls._evaluate_fullback(player_stats, position_group == 'WB')
        elif position_group == 'CDM':
            return cls._evaluate_defensive_midfielder(player_stats)
        elif position_group == 'CM':
            return cls._evaluate_central_midfielder(player_stats)
        elif position_group == 'CAM':
            return cls._evaluate_attacking_midfielder(player_stats)
        elif position_group in ['WM', 'W']:
            return cls._evaluate_winger(player_stats)
        elif position_group == 'ST':
            return cls._evaluate_striker(player_stats)
        else:
            return cls._empty_evaluation()

    @classmethod
    def _get_position_group(cls, position_code: int) -> Optional[str]:
        """í¬ì§€ì…˜ ì½”ë“œë¥¼ ê·¸ë£¹ìœ¼ë¡œ ë³€í™˜"""
        for group, codes in cls.POSITION_CODES.items():
            if position_code in codes:
                return group
        return None

    # ========== GOALKEEPER (GK) ==========
    @classmethod
    def _evaluate_goalkeeper(cls, stats: List[Dict]) -> Dict[str, Any]:
        """
        ê³¨í‚¤í¼ ì „ë¬¸ í‰ê°€

        í•µì‹¬ ì§€í‘œ:
        - ì„ ë°© ëŠ¥ë ¥ (25%)
        - ê³µì¤‘ë³¼ ì¥ì•… (10%)
        - ìœ„ì¹˜ ì„ ì • (10%)
        - íŒ¨ìŠ¤ ì •í™•ë„ (15%)
        - ë¹Œë“œì—… ê¸°ì—¬ (10%)
        - ì•ˆì •ì„± (20%)
        - í‰ì  ê¸°ë°˜ (10%)
        """
        num_matches = len(stats)

        # A. ê¸°ë³¸ ìˆ˜ë¹„ (45%)
        # ì„ ë°© ëŠ¥ë ¥
        total_saves = sum(s.get('saves') or 0 for s in stats)
        total_opponent_shots = sum(s.get('opponent_shots') or 0 for s in stats)
        save_percentage = (total_saves / total_opponent_shots * 100) if total_opponent_shots > 0 else 0

        # ì‹¤ì  vs xG
        total_goals_conceded = sum(s.get('goals_conceded') or 0 for s in stats)
        total_xg_against = sum(s.get('xg_against') or 0 for s in stats)
        xg_prevention = ((total_xg_against - total_goals_conceded) / num_matches) if total_xg_against > 0 else 0

        # í´ë¦°ì‹œíŠ¸
        clean_sheets = sum(1 for s in stats if (s.get('goals_conceded') or 0) == 0)
        clean_sheet_rate = (clean_sheets / num_matches * 100) if num_matches > 0 else 0

        # ì„ ë°© ëŠ¥ë ¥ ì ìˆ˜ (0-100)
        saving_score = min(100, (
            (save_percentage / 80 * 40) +  # 80% ì„ ë°©ë¥  = 40ì 
            (max(0, xg_prevention) * 10) +  # xG ëŒ€ë¹„ ì‹¤ì  ë°©ì–´
            (clean_sheet_rate / 50 * 20)  # í´ë¦°ì‹œíŠ¸ ë¹„ìœ¨
        ))

        # ê³µì¤‘ë³¼ ì¥ì•…
        total_aerial_success = sum(s.get('aerial_success', 0) for s in stats)
        aerial_score = min(100, total_aerial_success / num_matches * 10)  # ê²½ê¸°ë‹¹ 10íšŒ = 100ì 

        # B. ë°°ê¸‰ ëŠ¥ë ¥ (25%)
        total_pass_attempts = sum(s.get('pass_attempts', 0) for s in stats)
        total_pass_success = sum(s.get('pass_success', 0) for s in stats)
        pass_accuracy = (total_pass_success / total_pass_attempts * 100) if total_pass_attempts > 0 else 0

        total_long_pass_attempts = sum(s.get('long_pass_attempts', 0) for s in stats)
        total_long_pass_success = sum(s.get('long_pass_success', 0) for s in stats)
        long_pass_accuracy = (total_long_pass_success / total_long_pass_attempts * 100) if total_long_pass_attempts > 0 else 0

        # íŒ¨ìŠ¤ ì ìˆ˜
        passing_score = min(100, (
            (pass_accuracy / 80 * 60) +  # ì „ì²´ íŒ¨ìŠ¤ ì •í™•ë„
            (long_pass_accuracy / 60 * 40)  # ê¸´ íŒ¨ìŠ¤ ì •í™•ë„
        ))

        # ë¹Œë“œì—… ê¸°ì—¬
        avg_passes_per_game = total_pass_attempts / num_matches if num_matches > 0 else 0
        buildup_score = min(100, avg_passes_per_game / 30 * 100)  # ê²½ê¸°ë‹¹ 30ê°œ íŒ¨ìŠ¤ = 100ì 

        # C. ì•ˆì •ì„± (20%)
        # ì‹¤ìˆ˜ ìµœì†Œí™” (í•¸ë“¤ë§ ì—ëŸ¬, íŒ¨ìŠ¤ ë¯¸ìŠ¤ë¡œ ì¸í•œ ì‹¤ì  ë“±)
        total_errors = sum(s.get('errors_leading_to_goal') or 0 for s in stats)
        error_score = max(0, 100 - (total_errors * 20))  # ì—ëŸ¬ 1ê°œë‹¹ -20ì 

        # ì¼ê´€ì„± (í‰ì  ë¶„ì‚°)
        ratings = [s.get('rating', 6.5) for s in stats]
        rating_variance = statistics.variance(ratings) if len(ratings) > 1 else 0
        consistency_score = max(0, 100 - (rating_variance * 30))

        stability_score = (error_score * 0.75 + consistency_score * 0.25)

        # D. í‰ì  ê¸°ë°˜ (10%)
        avg_rating = statistics.mean(ratings) if ratings else 6.5
        rating_score = min(100, (avg_rating - 5.0) / 3.0 * 100)  # 5.0~8.0 ë²”ìœ„ë¥¼ 0~100ìœ¼ë¡œ

        # ìµœì¢… ì¢…í•© ì ìˆ˜ (ê°€ì¤‘ í‰ê· )
        final_score = (
            saving_score * 0.25 +  # ì„ ë°© ëŠ¥ë ¥
            aerial_score * 0.10 +  # ê³µì¤‘ë³¼
            passing_score * 0.15 +  # íŒ¨ìŠ¤ ì •í™•ë„
            buildup_score * 0.10 +  # ë¹Œë“œì—…
            stability_score * 0.20 +  # ì•ˆì •ì„±
            (saving_score * 0.1) +  # ìœ„ì¹˜ ì„ ì • (ì„ ë°©ê³¼ ì—°ê´€)
            rating_score * 0.10  # í‰ì 
        )

        return {
            'position_score': round(final_score, 1),
            'breakdown': {
                'saving_ability': {
                    'score': round(saving_score, 1),
                    'save_percentage': round(save_percentage, 1),
                    'xg_prevention': round(xg_prevention, 2),
                    'clean_sheets': clean_sheets,
                    'clean_sheet_rate': round(clean_sheet_rate, 1)
                },
                'aerial_dominance': {
                    'score': round(aerial_score, 1),
                    'total_aerial_wins': total_aerial_success
                },
                'distribution': {
                    'passing_score': round(passing_score, 1),
                    'pass_accuracy': round(pass_accuracy, 1),
                    'long_pass_accuracy': round(long_pass_accuracy, 1)
                },
                'buildup_contribution': {
                    'score': round(buildup_score, 1),
                    'avg_passes_per_game': round(avg_passes_per_game, 1)
                },
                'stability': {
                    'score': round(stability_score, 1),
                    'total_errors': total_errors,
                    'consistency': round(consistency_score, 1)
                },
                'rating': {
                    'score': round(rating_score, 1),
                    'avg_rating': round(avg_rating, 2)
                }
            },
            'key_strengths': cls._identify_gk_strengths(saving_score, passing_score, stability_score),
            'areas_for_improvement': cls._identify_gk_weaknesses(saving_score, passing_score, stability_score)
        }

    @classmethod
    def _identify_gk_strengths(cls, saving: float, passing: float, stability: float) -> List[str]:
        """ê³¨í‚¤í¼ ê°•ì  ì‹ë³„"""
        strengths = []
        if saving >= 80:
            strengths.append("ğŸ”¥ ë›°ì–´ë‚œ ì„ ë°© ëŠ¥ë ¥")
        if passing >= 75:
            strengths.append("âš½ ìš°ìˆ˜í•œ ë°œ ê¸°ìˆ ê³¼ ë°°ê¸‰")
        if stability >= 85:
            strengths.append("ğŸ›¡ï¸ ì•ˆì •ì ì´ê³  ì¼ê´€ëœ í¼í¬ë¨¼ìŠ¤")
        return strengths if strengths else ["ê¸°ë³¸ê¸° íƒ„íƒ„"]

    @classmethod
    def _identify_gk_weaknesses(cls, saving: float, passing: float, stability: float) -> List[str]:
        """ê³¨í‚¤í¼ ê°œì„  í•„ìš” ë¶€ë¶„ ì‹ë³„"""
        weaknesses = []
        if saving < 60:
            weaknesses.append("ì„ ë°© ëŠ¥ë ¥ í–¥ìƒ í•„ìš” - ìœ„ì¹˜ ì„ ì •ê³¼ ë°˜ì‘ ì†ë„ ê°œì„ ")
        if passing < 50:
            weaknesses.append("ë°œ ëŠ¥ë ¥ ê°œì„  í•„ìš” - íŒ¨ìŠ¤ ì •í™•ë„ í›ˆë ¨")
        if stability < 60:
            weaknesses.append("ì•ˆì •ì„± ê°œì„  í•„ìš” - ì‹¤ìˆ˜ ìµœì†Œí™” ë° ì§‘ì¤‘ë ¥ ìœ ì§€")
        return weaknesses if weaknesses else []

    # ========== CENTER BACK (CB) ==========
    @classmethod
    def _evaluate_center_back(cls, stats: List[Dict]) -> Dict[str, Any]:
        """
        ì¤‘ì•™ ìˆ˜ë¹„ìˆ˜ ì „ë¬¸ í‰ê°€

        í•µì‹¬ ì§€í‘œ:
        - íƒœí´ & ë³¼ ì°¨ë‹¨ (20%)
        - ê³µì¤‘ë³¼ ìš°ìœ„ (15%)
        - ìˆ˜ë¹„ ì•ˆì •ì„± (15%)
        - íŒ¨ìŠ¤ ëŠ¥ë ¥ (20%)
        - ì „ì§„ íŒ¨ìŠ¤ (5%)
        - ì¼ê´€ì„± (15%)
        - í‰ì  (10%)
        """
        num_matches = len(stats)

        # A. ìˆ˜ë¹„ ëŠ¥ë ¥ (50%)
        # íƒœí´ & ë³¼ ì°¨ë‹¨
        total_tackle_attempts = sum(s.get('tackle_attempts', 0) for s in stats)
        total_tackle_success = sum(s.get('tackle_success', 0) for s in stats)
        tackle_success_rate = (total_tackle_success / total_tackle_attempts * 100) if total_tackle_attempts > 0 else 0

        total_blocks = sum(s.get('blocks', 0) for s in stats)
        total_interceptions = sum(s.get('interceptions', 0) for s in stats)

        defensive_actions = (total_tackle_success + total_blocks + total_interceptions) / num_matches

        tackle_score = min(100, (
            (tackle_success_rate / 80 * 50) +  # 80% ì„±ê³µë¥  = 50ì 
            (defensive_actions / 8 * 50)  # ê²½ê¸°ë‹¹ 8íšŒ = 50ì 
        ))

        # ê³µì¤‘ë³¼
        total_aerial_success = sum(s.get('aerial_success', 0) for s in stats)
        aerial_per_game = total_aerial_success / num_matches
        aerial_score = min(100, aerial_per_game / 6 * 100)  # ê²½ê¸°ë‹¹ 6íšŒ = 100ì 

        # ìˆ˜ë¹„ ì•ˆì •ì„±
        total_fouls = sum(s.get('fouls', 0) for s in stats)
        total_yellow_cards = sum(s.get('yellow_cards', 0) for s in stats)
        total_red_cards = sum(s.get('red_cards', 0) for s in stats)

        foul_to_tackle_ratio = total_fouls / total_tackle_attempts if total_tackle_attempts > 0 else 0
        discipline_score = max(0, 100 - (foul_to_tackle_ratio * 100) - (total_yellow_cards * 5) - (total_red_cards * 20))

        # B. ë¹Œë“œì—… ëŠ¥ë ¥ (25%)
        total_pass_attempts = sum(s.get('pass_attempts', 0) for s in stats)
        total_pass_success = sum(s.get('pass_success', 0) for s in stats)
        pass_accuracy = (total_pass_success / total_pass_attempts * 100) if total_pass_attempts > 0 else 0

        total_long_pass_success = sum(s.get('long_pass_success', 0) for s in stats)

        passing_score = min(100, (
            (pass_accuracy / 85 * 70) +  # CBëŠ” 85% ì´ìƒ í•„ìš”
            (total_long_pass_success / num_matches / 3 * 30)  # ê²½ê¸°ë‹¹ 3ê°œ ê¸´íŒ¨ìŠ¤ = 30ì 
        ))

        # ì „ì§„ íŒ¨ìŠ¤
        total_through_pass = sum(s.get('through_pass_success', 0) for s in stats)
        total_assists = sum(s.get('assists', 0) for s in stats)
        forward_pass_score = min(100, (total_through_pass + total_assists * 3) / num_matches * 20)

        # C. ì¼ê´€ì„±
        ratings = [s.get('rating', 7.0) for s in stats]
        rating_variance = statistics.variance(ratings) if len(ratings) > 1 else 0
        consistency_score = max(0, 100 - (rating_variance * 40))

        # D. í‰ì 
        avg_rating = statistics.mean(ratings) if ratings else 7.0
        rating_score = min(100, (avg_rating - 5.5) / 2.5 * 100)

        # ìµœì¢… ì¢…í•© ì ìˆ˜
        final_score = (
            tackle_score * 0.20 +
            aerial_score * 0.15 +
            discipline_score * 0.15 +
            passing_score * 0.20 +
            forward_pass_score * 0.05 +
            consistency_score * 0.15 +
            rating_score * 0.10
        )

        return {
            'position_score': round(final_score, 1),
            'breakdown': {
                'defensive_ability': {
                    'tackle_score': round(tackle_score, 1),
                    'tackle_success_rate': round(tackle_success_rate, 1),
                    'defensive_actions_per_game': round(defensive_actions, 1),
                    'blocks': total_blocks,
                    'interceptions': total_interceptions
                },
                'aerial_dominance': {
                    'score': round(aerial_score, 1),
                    'aerial_wins_per_game': round(aerial_per_game, 1)
                },
                'discipline': {
                    'score': round(discipline_score, 1),
                    'fouls': total_fouls,
                    'yellow_cards': total_yellow_cards,
                    'red_cards': total_red_cards
                },
                'passing': {
                    'score': round(passing_score, 1),
                    'pass_accuracy': round(pass_accuracy, 1),
                    'long_passes': total_long_pass_success
                },
                'forward_contribution': {
                    'score': round(forward_pass_score, 1),
                    'through_passes': total_through_pass,
                    'assists': total_assists
                },
                'consistency': {
                    'score': round(consistency_score, 1),
                    'rating_variance': round(rating_variance, 2)
                },
                'rating': {
                    'score': round(rating_score, 1),
                    'avg_rating': round(avg_rating, 2)
                }
            },
            'key_strengths': cls._identify_cb_strengths(tackle_score, aerial_score, passing_score),
            'areas_for_improvement': cls._identify_cb_weaknesses(tackle_score, discipline_score, passing_score)
        }

    @classmethod
    def _identify_cb_strengths(cls, tackle: float, aerial: float, passing: float) -> List[str]:
        strengths = []
        if tackle >= 80:
            strengths.append("ğŸ›¡ï¸ ê°•ë ¥í•œ íƒœí´ê³¼ ë³¼ ì°¨ë‹¨")
        if aerial >= 75:
            strengths.append("ğŸ¯ ê³µì¤‘ë³¼ ì§€ë°°ë ¥")
        if passing >= 75:
            strengths.append("âš½ ë›°ì–´ë‚œ ë¹Œë“œì—… ëŠ¥ë ¥")
        return strengths if strengths else ["ì•ˆì •ì ì¸ ìˆ˜ë¹„"]

    @classmethod
    def _identify_cb_weaknesses(cls, tackle: float, discipline: float, passing: float) -> List[str]:
        weaknesses = []
        if tackle < 60:
            weaknesses.append("íƒœí´ ì •í™•ë„ í–¥ìƒ í•„ìš”")
        if discipline < 70:
            weaknesses.append("ë¶ˆí•„ìš”í•œ íŒŒìš¸ ì¤„ì´ê¸° - ìˆ˜ë¹„ íƒ€ì´ë° ê°œì„ ")
        if passing < 60:
            weaknesses.append("íŒ¨ìŠ¤ ì •í™•ë„ í–¥ìƒ - ë¹Œë“œì—… í›ˆë ¨ í•„ìš”")
        return weaknesses if weaknesses else []

    # ========== STRIKER (ST) ==========
    @classmethod
    def _evaluate_striker(cls, stats: List[Dict]) -> Dict[str, Any]:
        """
        ìŠ¤íŠ¸ë¼ì´ì»¤ ì „ë¬¸ í‰ê°€

        í•µì‹¬ ì§€í‘œ:
        - ë“ì  ëŠ¥ë ¥ (40%)
        - ìŠˆíŒ… ì„¼ìŠ¤ (15%)
        - ì—°ê³„ í”Œë ˆì´ (20%)
        - ê³µì¤‘ë³¼ ì§€ë°° (15%)
        - ì¼ê´€ì„± (10%)
        """
        num_matches = len(stats)

        # A. ê³¨ ê²°ì •ë ¥ (55%)
        total_goals = sum(s.get('goals', 0) for s in stats)
        goals_per_game = total_goals / num_matches if num_matches > 0 else 0

        total_shots = sum(s.get('shots', 0) for s in stats)
        shot_conversion = (total_goals / total_shots * 100) if total_shots > 0 else 0

        total_xg = sum(s.get('xg') or 0 for s in stats)
        goals_vs_xg = total_goals - total_xg if total_xg > 0 else 0

        # ë“ì  ëŠ¥ë ¥ ì ìˆ˜
        scoring_score = min(100, (
            (goals_per_game / 1.0 * 50) +  # ê²½ê¸°ë‹¹ 1ê³¨ = 50ì 
            (shot_conversion / 25 * 30) +  # 25% ì „í™˜ìœ¨ = 30ì 
            (max(0, goals_vs_xg) * 5)  # xG ëŒ€ë¹„ ì´ˆê³¼ ë“ì 
        ))

        # ìŠˆíŒ… ì„¼ìŠ¤
        total_shots_on_target = sum(s.get('shots_on_target', 0) for s in stats)
        shot_accuracy = (total_shots_on_target / total_shots * 100) if total_shots > 0 else 0

        shooting_sense_score = min(100, shot_accuracy / 60 * 100)  # 60% ì •í™•ë„ = 100ì 

        # B. ì—°ê³„ í”Œë ˆì´ (20%)
        total_assists = sum(s.get('assists', 0) for s in stats)
        total_key_passes = sum(s.get('key_passes', 0) for s in stats)

        link_play_score = min(100, (
            (total_assists / num_matches * 50) +  # ê²½ê¸°ë‹¹ 0.5 ì–´ì‹œìŠ¤íŠ¸ = 25ì 
            (total_key_passes / num_matches / 2 * 50)  # ê²½ê¸°ë‹¹ 2ê°œ í‚¤íŒ¨ìŠ¤ = 50ì 
        ))

        # C. ê³µì¤‘ë³¼ ì§€ë°° (15%)
        total_aerial_success = sum(s.get('aerial_success', 0) for s in stats)
        aerial_per_game = total_aerial_success / num_matches
        aerial_score = min(100, aerial_per_game / 4 * 100)  # ê²½ê¸°ë‹¹ 4íšŒ = 100ì 

        # D. ì¼ê´€ì„± (10%)
        ratings = [s.get('rating', 7.0) for s in stats]
        consecutive_scoring_games = cls._count_consecutive_scoring(stats)
        consistency_score = min(100, consecutive_scoring_games / (num_matches * 0.5) * 100)

        # ìµœì¢… ì¢…í•© ì ìˆ˜
        final_score = (
            scoring_score * 0.40 +
            shooting_sense_score * 0.15 +
            link_play_score * 0.20 +
            aerial_score * 0.15 +
            consistency_score * 0.10
        )

        return {
            'position_score': round(final_score, 1),
            'breakdown': {
                'scoring_ability': {
                    'score': round(scoring_score, 1),
                    'goals_per_game': round(goals_per_game, 2),
                    'shot_conversion': round(shot_conversion, 1),
                    'goals_vs_xg': round(goals_vs_xg, 2),
                    'total_goals': total_goals
                },
                'shooting_sense': {
                    'score': round(shooting_sense_score, 1),
                    'shot_accuracy': round(shot_accuracy, 1)
                },
                'link_play': {
                    'score': round(link_play_score, 1),
                    'assists': total_assists,
                    'key_passes': total_key_passes
                },
                'aerial_dominance': {
                    'score': round(aerial_score, 1),
                    'aerial_wins_per_game': round(aerial_per_game, 1)
                },
                'consistency': {
                    'score': round(consistency_score, 1),
                    'consecutive_scoring_games': consecutive_scoring_games
                }
            },
            'key_strengths': cls._identify_st_strengths(scoring_score, link_play_score, aerial_score),
            'areas_for_improvement': cls._identify_st_weaknesses(scoring_score, shooting_sense_score, consistency_score)
        }

    @classmethod
    def _count_consecutive_scoring(cls, stats: List[Dict]) -> int:
        """ì—°ì† ë“ì  ê²½ê¸° ìˆ˜ ê³„ì‚°"""
        max_consecutive = 0
        current_consecutive = 0

        for stat in stats:
            if stat.get('goals', 0) > 0:
                current_consecutive += 1
                max_consecutive = max(max_consecutive, current_consecutive)
            else:
                current_consecutive = 0

        return max_consecutive

    @classmethod
    def _identify_st_strengths(cls, scoring: float, link: float, aerial: float) -> List[str]:
        strengths = []
        if scoring >= 80:
            strengths.append("ğŸ”¥ ë›°ì–´ë‚œ ê³¨ ê²°ì •ë ¥")
        if link >= 75:
            strengths.append("ğŸ¤ ìš°ìˆ˜í•œ ì—°ê³„ í”Œë ˆì´")
        if aerial >= 75:
            strengths.append("ğŸ¯ ê°•ë ¥í•œ ê³µì¤‘ë³¼ ëŠ¥ë ¥")
        return strengths if strengths else ["ê¸°ë³¸ê¸° íƒ„íƒ„í•œ ê³µê²©ìˆ˜"]

    @classmethod
    def _identify_st_weaknesses(cls, scoring: float, shooting: float, consistency: float) -> List[str]:
        weaknesses = []
        if scoring < 60:
            weaknesses.append("ê³¨ ê²°ì •ë ¥ í–¥ìƒ í•„ìš” - ìŠˆíŒ… í›ˆë ¨ ì§‘ì¤‘")
        if shooting < 50:
            weaknesses.append("ìŠˆíŒ… ì •í™•ë„ ê°œì„  - ê³¨ë¬¸ ë§ì¶”ê¸° í›ˆë ¨")
        if consistency < 50:
            weaknesses.append("ì¼ê´€ì„± ê°œì„  - ê¾¸ì¤€í•œ ë“ì  í•„ìš”")
        return weaknesses if weaknesses else []

    # ========== FULLBACK / WINGBACK (FB, WB) ==========
    @classmethod
    def _evaluate_fullback(cls, stats: List[Dict], is_wingback: bool = False) -> Dict[str, Any]:
        """
        í’€ë°±/ìœ™ë°± ì „ë¬¸ í‰ê°€

        í•µì‹¬ ì§€í‘œ:
        - ìˆ˜ë¹„ ëŠ¥ë ¥ (35%): 1ëŒ€1 ìˆ˜ë¹„, ì¸¡ë©´ ë´‰ì‡„, ìœ„ì¹˜ ì„ ì •
        - ê³µê²© ê¸°ì—¬ (40%): í¬ë¡œìŠ¤, ì „ì§„ í”Œë ˆì´, ì˜¤ë²„ë˜í•‘
        - ì²´ë ¥ & ì¼ê´€ì„± (15%)
        - í‰ì  ê¸°ë°˜ (10%)
        """
        num_matches = len(stats)

        # A. ìˆ˜ë¹„ ëŠ¥ë ¥ (35%)
        # 1ëŒ€1 ìˆ˜ë¹„
        total_tackle_attempts = sum(s.get('tackle_attempts', 0) for s in stats)
        total_tackle_success = sum(s.get('tackle_success', 0) for s in stats)
        tackle_success_rate = (total_tackle_success / total_tackle_attempts * 100) if total_tackle_attempts > 0 else 0

        total_dribble_stops = sum(s.get('dribble_stops', 0) for s in stats)  # ë“œë¦¬ë¸” ì €ì§€
        one_on_one_score = min(100, (
            (tackle_success_rate / 75 * 60) +  # 75% ì„±ê³µë¥  = 60ì 
            (total_dribble_stops / num_matches / 3 * 40)  # ê²½ê¸°ë‹¹ 3íšŒ ì €ì§€ = 40ì 
        ))

        # ì¸¡ë©´ ë´‰ì‡„
        total_interceptions = sum(s.get('interceptions', 0) for s in stats)
        total_blocks = sum(s.get('blocks', 0) for s in stats)
        wing_defense_score = min(100, (total_interceptions + total_blocks) / num_matches / 4 * 100)  # ê²½ê¸°ë‹¹ 4íšŒ = 100ì 

        # ìˆ˜ë¹„ ìœ„ì¹˜ ì„ ì • (íŒŒìš¸ ìµœì†Œí™”)
        total_fouls = sum(s.get('fouls', 0) for s in stats)
        total_yellow_cards = sum(s.get('yellow_cards', 0) for s in stats)
        positioning_score = max(0, 100 - (total_fouls / num_matches * 10) - (total_yellow_cards * 5))

        # B. ê³µê²© ê¸°ì—¬ (40%)
        # í¬ë¡œìŠ¤ & ì°¬ìŠ¤ ì°½ì¶œ
        total_crosses = sum(s.get('crosses', 0) for s in stats)
        total_cross_success = sum(s.get('cross_success', 0) for s in stats)
        cross_accuracy = (total_cross_success / total_crosses * 100) if total_crosses > 0 else 0

        total_assists = sum(s.get('assists', 0) for s in stats)
        total_key_passes = sum(s.get('key_passes', 0) for s in stats)

        crossing_score = min(100, (
            (cross_accuracy / 35 * 40) +  # 35% ì •í™•ë„ = 40ì 
            (total_assists / num_matches * 100) +  # ê²½ê¸°ë‹¹ 0.3 ì–´ì‹œìŠ¤íŠ¸ = 30ì 
            (total_key_passes / num_matches / 2 * 30)  # ê²½ê¸°ë‹¹ 2ê°œ í‚¤íŒ¨ìŠ¤ = 30ì 
        ))

        # ì „ì§„ í”Œë ˆì´
        total_dribble_attempts = sum(s.get('dribble_attempts', 0) for s in stats)
        total_dribble_success = sum(s.get('dribble_success', 0) for s in stats)
        dribble_success_rate = (total_dribble_success / total_dribble_attempts * 100) if total_dribble_attempts > 0 else 0

        total_forward_passes = sum(s.get('forward_passes', 0) for s in stats)
        forward_play_score = min(100, (
            (dribble_success_rate / 60 * 50) +  # 60% ì„±ê³µë¥  = 50ì 
            (total_forward_passes / num_matches / 10 * 50)  # ê²½ê¸°ë‹¹ 10ê°œ = 50ì 
        ))

        # ì˜¤ë²„ë˜í•‘ (ê³µê²© ê°€ë‹´)
        total_shots = sum(s.get('shots', 0) for s in stats)
        overlapping_score = min(100, total_shots / num_matches * 30)  # ê²½ê¸°ë‹¹ 3.3íšŒ ìŠˆíŒ… = 100ì 

        # C. ì²´ë ¥ & ì¼ê´€ì„± (15%)
        ratings = [s.get('rating', 7.0) for s in stats]
        rating_variance = statistics.variance(ratings) if len(ratings) > 1 else 0
        stamina_consistency_score = max(0, 100 - (rating_variance * 35))

        # D. í‰ì  (10%)
        avg_rating = statistics.mean(ratings) if ratings else 7.0
        rating_score = min(100, (avg_rating - 5.5) / 2.5 * 100)

        # ìµœì¢… ì¢…í•© ì ìˆ˜
        # WBëŠ” ê³µê²© ê°€ì¤‘ì¹˜ ì¡°ê¸ˆ ë” ë†’ê²Œ
        if is_wingback:
            final_score = (
                one_on_one_score * 0.12 +
                wing_defense_score * 0.08 +
                positioning_score * 0.10 +
                crossing_score * 0.22 +
                forward_play_score * 0.18 +
                overlapping_score * 0.05 +
                stamina_consistency_score * 0.15 +
                rating_score * 0.10
            )
        else:  # FB
            final_score = (
                one_on_one_score * 0.15 +
                wing_defense_score * 0.10 +
                positioning_score * 0.10 +
                crossing_score * 0.20 +
                forward_play_score * 0.15 +
                overlapping_score * 0.05 +
                stamina_consistency_score * 0.15 +
                rating_score * 0.10
            )

        return {
            'position_score': round(final_score, 1),
            'breakdown': {
                'defensive_ability': {
                    'one_on_one_score': round(one_on_one_score, 1),
                    'tackle_success_rate': round(tackle_success_rate, 1),
                    'wing_defense_score': round(wing_defense_score, 1),
                    'positioning_score': round(positioning_score, 1)
                },
                'attacking_contribution': {
                    'crossing_score': round(crossing_score, 1),
                    'cross_accuracy': round(cross_accuracy, 1),
                    'assists': total_assists,
                    'forward_play_score': round(forward_play_score, 1),
                    'dribble_success_rate': round(dribble_success_rate, 1)
                },
                'stamina_consistency': {
                    'score': round(stamina_consistency_score, 1),
                    'rating_variance': round(rating_variance, 2)
                },
                'rating': {
                    'score': round(rating_score, 1),
                    'avg_rating': round(avg_rating, 2)
                }
            },
            'key_strengths': cls._identify_fb_strengths(crossing_score, one_on_one_score, forward_play_score),
            'areas_for_improvement': cls._identify_fb_weaknesses(crossing_score, one_on_one_score, positioning_score)
        }

    @classmethod
    def _identify_fb_strengths(cls, crossing: float, defense: float, forward: float) -> List[str]:
        strengths = []
        if crossing >= 75:
            strengths.append("ğŸ¯ ë›°ì–´ë‚œ í¬ë¡œìŠ¤ì™€ ì°¬ìŠ¤ ë©”ì´í‚¹")
        if defense >= 75:
            strengths.append("ğŸ›¡ï¸ ê°•ë ¥í•œ 1ëŒ€1 ìˆ˜ë¹„")
        if forward >= 75:
            strengths.append("âš¡ ì ê·¹ì ì¸ ê³µê²© ê°€ë‹´")
        return strengths if strengths else ["ê· í˜•ì¡íŒ í’€ë°±"]

    @classmethod
    def _identify_fb_weaknesses(cls, crossing: float, defense: float, positioning: float) -> List[str]:
        weaknesses = []
        if crossing < 55:
            weaknesses.append("í¬ë¡œìŠ¤ ì •í™•ë„ í–¥ìƒ í•„ìš”")
        if defense < 60:
            weaknesses.append("1ëŒ€1 ìˆ˜ë¹„ ëŠ¥ë ¥ ê°œì„ ")
        if positioning < 65:
            weaknesses.append("ìˆ˜ë¹„ ìœ„ì¹˜ ì„ ì • ê°œì„  - ë¶ˆí•„ìš”í•œ íŒŒìš¸ ì¤„ì´ê¸°")
        return weaknesses if weaknesses else []

    # ========== DEFENSIVE MIDFIELDER (CDM) ==========
    @classmethod
    def _evaluate_defensive_midfielder(cls, stats: List[Dict]) -> Dict[str, Any]:
        """
        ìˆ˜ë¹„í˜• ë¯¸ë“œí•„ë” ì „ë¬¸ í‰ê°€

        í•µì‹¬ ì§€í‘œ:
        - ìˆ˜ë¹„ ì°¨ë‹¨ (40%): ë³¼ íƒˆì·¨, ê³µì¤‘ë³¼, ì••ë°•
        - íŒ¨ìŠ¤ & ë¹Œë“œì—… (35%): ë°°ê¸‰ ëŠ¥ë ¥, ì „í™˜
        - ì¼ê´€ì„± & ê·œìœ¨ (15%)
        - í‰ì  ê¸°ë°˜ (10%)
        """
        num_matches = len(stats)

        # A. ìˆ˜ë¹„ ì°¨ë‹¨ (40%)
        # ë³¼ íƒˆì·¨
        total_tackle_attempts = sum(s.get('tackle_attempts', 0) for s in stats)
        total_tackle_success = sum(s.get('tackle_success', 0) for s in stats)
        tackle_success_rate = (total_tackle_success / total_tackle_attempts * 100) if total_tackle_attempts > 0 else 0

        total_interceptions = sum(s.get('interceptions', 0) for s in stats)
        total_blocks = sum(s.get('blocks', 0) for s in stats)

        ball_winning_score = min(100, (
            (tackle_success_rate / 80 * 50) +  # 80% ì„±ê³µë¥  = 50ì 
            ((total_interceptions + total_blocks) / num_matches / 6 * 50)  # ê²½ê¸°ë‹¹ 6íšŒ = 50ì 
        ))

        # ê³µì¤‘ë³¼ ì§€ë°°
        total_aerial_success = sum(s.get('aerial_success', 0) for s in stats)
        aerial_score = min(100, total_aerial_success / num_matches / 4 * 100)  # ê²½ê¸°ë‹¹ 4íšŒ = 100ì 

        # ì••ë°• ê°•ë„
        defensive_actions = (total_tackle_attempts + total_interceptions + total_blocks) / num_matches
        total_fouls = sum(s.get('fouls', 0) for s in stats)
        foul_efficiency = total_fouls / defensive_actions if defensive_actions > 0 else 0
        pressing_score = max(0, 100 - (foul_efficiency * 100))  # íŒŒìš¸ ëŒ€ë¹„ íš¨ìœ¨

        # B. íŒ¨ìŠ¤ & ë¹Œë“œì—… (35%)
        # ë°°ê¸‰ ëŠ¥ë ¥
        total_pass_attempts = sum(s.get('pass_attempts', 0) for s in stats)
        total_pass_success = sum(s.get('pass_success', 0) for s in stats)
        pass_accuracy = (total_pass_success / total_pass_attempts * 100) if total_pass_attempts > 0 else 0

        avg_passes_per_game = total_pass_attempts / num_matches if num_matches > 0 else 0
        distribution_score = min(100, (
            (pass_accuracy / 85 * 60) +  # 85% ì •í™•ë„ = 60ì 
            (avg_passes_per_game / 50 * 40)  # ê²½ê¸°ë‹¹ 50ê°œ = 40ì 
        ))

        # ì „í™˜ í”Œë ˆì´
        total_long_pass_success = sum(s.get('long_pass_success', 0) for s in stats)
        total_through_pass_success = sum(s.get('through_pass_success', 0) for s in stats)
        transition_score = min(100, (total_long_pass_success + total_through_pass_success * 2) / num_matches / 4 * 100)

        # C. ì¼ê´€ì„± & ê·œìœ¨ (15%)
        ratings = [s.get('rating', 7.0) for s in stats]
        rating_variance = statistics.variance(ratings) if len(ratings) > 1 else 0

        total_yellow_cards = sum(s.get('yellow_cards', 0) for s in stats)
        total_red_cards = sum(s.get('red_cards', 0) for s in stats)

        discipline_score = max(0, 100 - (rating_variance * 30) - (total_yellow_cards * 3) - (total_red_cards * 15))

        # D. í‰ì  (10%)
        avg_rating = statistics.mean(ratings) if ratings else 7.0
        rating_score = min(100, (avg_rating - 5.5) / 2.5 * 100)

        # ìµœì¢… ì¢…í•© ì ìˆ˜
        final_score = (
            ball_winning_score * 0.25 +
            aerial_score * 0.10 +
            pressing_score * 0.05 +
            distribution_score * 0.25 +
            transition_score * 0.10 +
            discipline_score * 0.15 +
            rating_score * 0.10
        )

        return {
            'position_score': round(final_score, 1),
            'breakdown': {
                'ball_winning': {
                    'score': round(ball_winning_score, 1),
                    'tackle_success_rate': round(tackle_success_rate, 1),
                    'interceptions': total_interceptions,
                    'blocks': total_blocks
                },
                'aerial_dominance': {
                    'score': round(aerial_score, 1),
                    'aerial_wins_per_game': round(total_aerial_success / num_matches, 1)
                },
                'pressing': {
                    'score': round(pressing_score, 1),
                    'defensive_actions_per_game': round(defensive_actions, 1)
                },
                'distribution': {
                    'score': round(distribution_score, 1),
                    'pass_accuracy': round(pass_accuracy, 1),
                    'avg_passes_per_game': round(avg_passes_per_game, 1)
                },
                'transition_play': {
                    'score': round(transition_score, 1),
                    'long_passes': total_long_pass_success,
                    'through_passes': total_through_pass_success
                },
                'discipline_consistency': {
                    'score': round(discipline_score, 1),
                    'yellow_cards': total_yellow_cards,
                    'red_cards': total_red_cards
                },
                'rating': {
                    'score': round(rating_score, 1),
                    'avg_rating': round(avg_rating, 2)
                }
            },
            'key_strengths': cls._identify_cdm_strengths(ball_winning_score, distribution_score, discipline_score),
            'areas_for_improvement': cls._identify_cdm_weaknesses(ball_winning_score, distribution_score, discipline_score)
        }

    @classmethod
    def _identify_cdm_strengths(cls, ball_winning: float, distribution: float, discipline: float) -> List[str]:
        strengths = []
        if ball_winning >= 80:
            strengths.append("ğŸ›¡ï¸ ë›°ì–´ë‚œ ë³¼ íƒˆì·¨ ëŠ¥ë ¥")
        if distribution >= 80:
            strengths.append("âš½ ì•ˆì •ì ì¸ ë°°ê¸‰ í”Œë ˆì´")
        if discipline >= 85:
            strengths.append("ğŸ“Š ì¼ê´€ë˜ê³  ê·œìœ¨ìˆëŠ” í”Œë ˆì´")
        return strengths if strengths else ["ë¯¿ìŒì§í•œ ìˆ˜ë¹„í˜• ë¯¸ë“œí•„ë”"]

    @classmethod
    def _identify_cdm_weaknesses(cls, ball_winning: float, distribution: float, discipline: float) -> List[str]:
        weaknesses = []
        if ball_winning < 60:
            weaknesses.append("ìˆ˜ë¹„ ì°¨ë‹¨ ëŠ¥ë ¥ í–¥ìƒ í•„ìš”")
        if distribution < 65:
            weaknesses.append("íŒ¨ìŠ¤ ì •í™•ë„ ê°œì„  - ë°°ê¸‰ ì•ˆì •ì„± í–¥ìƒ")
        if discipline < 65:
            weaknesses.append("ë¶ˆí•„ìš”í•œ íŒŒìš¸ê³¼ ê²½ê³  ì¤„ì´ê¸°")
        return weaknesses if weaknesses else []

    # ========== CENTRAL MIDFIELDER (CM) ==========
    @classmethod
    def _evaluate_central_midfielder(cls, stats: List[Dict]) -> Dict[str, Any]:
        """
        ì¤‘ì•™ ë¯¸ë“œí•„ë” ì „ë¬¸ í‰ê°€

        í•µì‹¬ ì§€í‘œ:
        - íŒ¨ìŠ¤ & ì°½ì¡°ë ¥ (40%): íŒ¨ìŠ¤ ë§ˆìŠ¤í„°, ì°¬ìŠ¤ ì°½ì¶œ
        - ìˆ˜ë¹„ ê¸°ì—¬ (25%)
        - ê³µê²© ê¸°ì—¬ (20%)
        - ì¼ê´€ì„± (10%)
        - í‰ì  (5%)
        """
        num_matches = len(stats)

        # A. íŒ¨ìŠ¤ & ì°½ì¡°ë ¥ (40%)
        # íŒ¨ìŠ¤ ë§ˆìŠ¤í„°
        total_pass_attempts = sum(s.get('pass_attempts', 0) for s in stats)
        total_pass_success = sum(s.get('pass_success', 0) for s in stats)
        pass_accuracy = (total_pass_success / total_pass_attempts * 100) if total_pass_attempts > 0 else 0

        avg_passes_per_game = total_pass_attempts / num_matches if num_matches > 0 else 0

        total_short_pass_success = sum(s.get('short_pass_success', 0) for s in stats)
        total_long_pass_success = sum(s.get('long_pass_success', 0) for s in stats)

        passing_mastery_score = min(100, (
            (pass_accuracy / 80 * 50) +  # 80% ì •í™•ë„ = 50ì 
            (avg_passes_per_game / 60 * 30) +  # ê²½ê¸°ë‹¹ 60ê°œ = 30ì 
            ((total_short_pass_success + total_long_pass_success) / total_pass_attempts * 20) if total_pass_attempts > 0 else 0
        ))

        # ì°¬ìŠ¤ ì°½ì¶œ
        total_assists = sum(s.get('assists', 0) for s in stats)
        total_key_passes = sum(s.get('key_passes', 0) for s in stats)
        total_through_pass_success = sum(s.get('through_pass_success', 0) for s in stats)

        chance_creation_score = min(100, (
            (total_assists / num_matches * 80) +  # ê²½ê¸°ë‹¹ 0.5 ì–´ì‹œìŠ¤íŠ¸ = 40ì 
            (total_key_passes / num_matches / 3 * 40) +  # ê²½ê¸°ë‹¹ 3ê°œ = 40ì 
            (total_through_pass_success / num_matches * 20)  # ê²½ê¸°ë‹¹ 1ê°œ = 20ì 
        ))

        # B. ìˆ˜ë¹„ ê¸°ì—¬ (25%)
        total_tackle_success = sum(s.get('tackle_success', 0) for s in stats)
        total_interceptions = sum(s.get('interceptions', 0) for s in stats)

        defensive_contribution_score = min(100, (total_tackle_success + total_interceptions) / num_matches / 5 * 100)  # ê²½ê¸°ë‹¹ 5íšŒ = 100ì 

        # C. ê³µê²© ê¸°ì—¬ (20%)
        total_goals = sum(s.get('goals', 0) for s in stats)
        total_shots = sum(s.get('shots', 0) for s in stats)
        total_shots_on_target = sum(s.get('shots_on_target', 0) for s in stats)

        shot_accuracy = (total_shots_on_target / total_shots * 100) if total_shots > 0 else 0

        attacking_contribution_score = min(100, (
            (total_goals / num_matches * 80) +  # ê²½ê¸°ë‹¹ 0.3ê³¨ = 24ì 
            (shot_accuracy / 50 * 20)  # 50% ì •í™•ë„ = 20ì 
        ))

        # D. ì¼ê´€ì„± (10%)
        ratings = [s.get('rating', 7.0) for s in stats]
        rating_variance = statistics.variance(ratings) if len(ratings) > 1 else 0
        consistency_score = max(0, 100 - (rating_variance * 35))

        # E. í‰ì  (5%)
        avg_rating = statistics.mean(ratings) if ratings else 7.0
        rating_score = min(100, (avg_rating - 6.0) / 2.0 * 100)

        # ìµœì¢… ì¢…í•© ì ìˆ˜
        final_score = (
            passing_mastery_score * 0.25 +
            chance_creation_score * 0.15 +
            defensive_contribution_score * 0.25 +
            attacking_contribution_score * 0.20 +
            consistency_score * 0.10 +
            rating_score * 0.05
        )

        return {
            'position_score': round(final_score, 1),
            'breakdown': {
                'passing_mastery': {
                    'score': round(passing_mastery_score, 1),
                    'pass_accuracy': round(pass_accuracy, 1),
                    'avg_passes_per_game': round(avg_passes_per_game, 1)
                },
                'chance_creation': {
                    'score': round(chance_creation_score, 1),
                    'assists': total_assists,
                    'key_passes': total_key_passes,
                    'through_passes': total_through_pass_success
                },
                'defensive_contribution': {
                    'score': round(defensive_contribution_score, 1),
                    'tackles': total_tackle_success,
                    'interceptions': total_interceptions
                },
                'attacking_contribution': {
                    'score': round(attacking_contribution_score, 1),
                    'goals': total_goals,
                    'shot_accuracy': round(shot_accuracy, 1)
                },
                'consistency': {
                    'score': round(consistency_score, 1),
                    'rating_variance': round(rating_variance, 2)
                },
                'rating': {
                    'score': round(rating_score, 1),
                    'avg_rating': round(avg_rating, 2)
                }
            },
            'key_strengths': cls._identify_cm_strengths(passing_mastery_score, chance_creation_score, defensive_contribution_score),
            'areas_for_improvement': cls._identify_cm_weaknesses(passing_mastery_score, defensive_contribution_score, attacking_contribution_score)
        }

    @classmethod
    def _identify_cm_strengths(cls, passing: float, chance_creation: float, defense: float) -> List[str]:
        strengths = []
        if passing >= 80:
            strengths.append("âš½ ë›°ì–´ë‚œ íŒ¨ìŠ¤ ëŠ¥ë ¥")
        if chance_creation >= 75:
            strengths.append("ğŸ¯ ìš°ìˆ˜í•œ ì°¬ìŠ¤ ë©”ì´í‚¹")
        if defense >= 75:
            strengths.append("ğŸ›¡ï¸ í›Œë¥­í•œ ìˆ˜ë¹„ ì§€ì›")
        return strengths if strengths else ["ê· í˜•ì¡íŒ ë¯¸ë“œí•„ë”"]

    @classmethod
    def _identify_cm_weaknesses(cls, passing: float, defense: float, attack: float) -> List[str]:
        weaknesses = []
        if passing < 65:
            weaknesses.append("íŒ¨ìŠ¤ ì •í™•ë„ í–¥ìƒ í•„ìš”")
        if defense < 55:
            weaknesses.append("ìˆ˜ë¹„ ê¸°ì—¬ë„ í–¥ìƒ - ë³¼ íƒˆì·¨ ëŠ¥ë ¥ ê°œì„ ")
        if attack < 50:
            weaknesses.append("ê³µê²© ê¸°ì—¬ ê°œì„  - ë“ì  ëŠ¥ë ¥ í–¥ìƒ")
        return weaknesses if weaknesses else []

    # ========== ATTACKING MIDFIELDER (CAM) ==========
    @classmethod
    def _evaluate_attacking_midfielder(cls, stats: List[Dict]) -> Dict[str, Any]:
        """
        ê³µê²©í˜• ë¯¸ë“œí•„ë” ì „ë¬¸ í‰ê°€

        í•µì‹¬ ì§€í‘œ:
        - ì°½ì¡°ë ¥ (45%): ì–´ì‹œìŠ¤íŠ¸ & ì°¬ìŠ¤ ì°½ì¶œ, íŒ¨ìŠ¤ ì„¼ìŠ¤
        - ê³¨ ê²°ì •ë ¥ (30%)
        - ë“œë¦¬ë¸” & ëŒíŒŒ (15%)
        - ì¼ê´€ì„± (10%)
        """
        num_matches = len(stats)

        # A. ì°½ì¡°ë ¥ (45%)
        # ì–´ì‹œìŠ¤íŠ¸ & ì°¬ìŠ¤ ì°½ì¶œ
        total_assists = sum(s.get('assists', 0) for s in stats)
        total_key_passes = sum(s.get('key_passes', 0) for s in stats)
        total_through_pass_success = sum(s.get('through_pass_success', 0) for s in stats)

        creativity_score = min(100, (
            (total_assists / num_matches * 100) +  # ê²½ê¸°ë‹¹ 0.5 ì–´ì‹œìŠ¤íŠ¸ = 50ì 
            (total_key_passes / num_matches / 3 * 30) +  # ê²½ê¸°ë‹¹ 3ê°œ = 30ì 
            (total_through_pass_success / num_matches * 20)  # ê²½ê¸°ë‹¹ 1ê°œ = 20ì 
        ))

        # íŒ¨ìŠ¤ ì„¼ìŠ¤
        total_pass_attempts = sum(s.get('pass_attempts', 0) for s in stats)
        total_pass_success = sum(s.get('pass_success', 0) for s in stats)
        pass_accuracy = (total_pass_success / total_pass_attempts * 100) if total_pass_attempts > 0 else 0

        # ìµœì¢… 1/3 ì§€ì—­ íŒ¨ìŠ¤ (final third passes)
        pass_sense_score = min(100, pass_accuracy / 75 * 100)  # 75% ì •í™•ë„ = 100ì 

        # B. ê³¨ ê²°ì •ë ¥ (30%)
        total_goals = sum(s.get('goals', 0) for s in stats)
        goals_per_game = total_goals / num_matches if num_matches > 0 else 0

        total_shots = sum(s.get('shots', 0) for s in stats)
        shot_conversion = (total_goals / total_shots * 100) if total_shots > 0 else 0

        total_xg = sum(s.get('xg') or 0 for s in stats)
        goals_vs_xg = total_goals - total_xg if total_xg > 0 else 0

        finishing_score = min(100, (
            (goals_per_game / 0.5 * 50) +  # ê²½ê¸°ë‹¹ 0.5ê³¨ = 50ì 
            (shot_conversion / 20 * 30) +  # 20% ì „í™˜ìœ¨ = 30ì 
            (max(0, goals_vs_xg) * 5)  # xG ì´ˆê³¼
        ))

        # C. ë“œë¦¬ë¸” & ëŒíŒŒ (15%)
        total_dribble_attempts = sum(s.get('dribble_attempts', 0) for s in stats)
        total_dribble_success = sum(s.get('dribble_success', 0) for s in stats)
        dribble_success_rate = (total_dribble_success / total_dribble_attempts * 100) if total_dribble_attempts > 0 else 0

        dribbling_score = min(100, (
            (dribble_success_rate / 60 * 70) +  # 60% ì„±ê³µë¥  = 70ì 
            (total_dribble_success / num_matches / 3 * 30)  # ê²½ê¸°ë‹¹ 3íšŒ = 30ì 
        ))

        # D. ì¼ê´€ì„± (10%)
        ratings = [s.get('rating', 7.5) for s in stats]
        rating_variance = statistics.variance(ratings) if len(ratings) > 1 else 0
        consistency_score = max(0, 100 - (rating_variance * 30))

        # ìµœì¢… ì¢…í•© ì ìˆ˜
        final_score = (
            creativity_score * 0.30 +
            pass_sense_score * 0.15 +
            finishing_score * 0.30 +
            dribbling_score * 0.15 +
            consistency_score * 0.10
        )

        return {
            'position_score': round(final_score, 1),
            'breakdown': {
                'creativity': {
                    'score': round(creativity_score, 1),
                    'assists': total_assists,
                    'key_passes': total_key_passes,
                    'through_passes': total_through_pass_success
                },
                'passing_sense': {
                    'score': round(pass_sense_score, 1),
                    'pass_accuracy': round(pass_accuracy, 1)
                },
                'finishing': {
                    'score': round(finishing_score, 1),
                    'goals': total_goals,
                    'goals_per_game': round(goals_per_game, 2),
                    'shot_conversion': round(shot_conversion, 1)
                },
                'dribbling': {
                    'score': round(dribbling_score, 1),
                    'dribble_success_rate': round(dribble_success_rate, 1)
                },
                'consistency': {
                    'score': round(consistency_score, 1),
                    'rating_variance': round(rating_variance, 2)
                }
            },
            'key_strengths': cls._identify_cam_strengths(creativity_score, finishing_score, dribbling_score),
            'areas_for_improvement': cls._identify_cam_weaknesses(creativity_score, finishing_score, dribbling_score)
        }

    @classmethod
    def _identify_cam_strengths(cls, creativity: float, finishing: float, dribbling: float) -> List[str]:
        strengths = []
        if creativity >= 80:
            strengths.append("ğŸ¨ íƒì›”í•œ ì°½ì¡°ë ¥ê³¼ ì°¬ìŠ¤ ë©”ì´í‚¹")
        if finishing >= 75:
            strengths.append("âš½ ìš°ìˆ˜í•œ ë“ì  ëŠ¥ë ¥")
        if dribbling >= 75:
            strengths.append("ğŸ’¨ ë›°ì–´ë‚œ ë“œë¦¬ë¸”ê³¼ ëŒíŒŒ")
        return strengths if strengths else ["ê³µê²©ì ì¸ í”Œë ˆì´ë©”ì´ì»¤"]

    @classmethod
    def _identify_cam_weaknesses(cls, creativity: float, finishing: float, dribbling: float) -> List[str]:
        weaknesses = []
        if creativity < 60:
            weaknesses.append("ì°¬ìŠ¤ ì°½ì¶œ ëŠ¥ë ¥ í–¥ìƒ - í‚¬íŒ¨ìŠ¤ì™€ ì–´ì‹œìŠ¤íŠ¸ ê°œì„ ")
        if finishing < 55:
            weaknesses.append("ê³¨ ê²°ì •ë ¥ í–¥ìƒ - ìŠˆíŒ… ì •í™•ë„ í›ˆë ¨")
        if dribbling < 55:
            weaknesses.append("ë“œë¦¬ë¸” ì„±ê³µë¥  ê°œì„ ")
        return weaknesses if weaknesses else []

    # ========== WINGER (W, WM) ==========
    @classmethod
    def _evaluate_winger(cls, stats: List[Dict]) -> Dict[str, Any]:
        """
        ìœ™ì–´ ì „ë¬¸ í‰ê°€

        í•µì‹¬ ì§€í‘œ:
        - ê³¨ & ì°¬ìŠ¤ ì°½ì¶œ (45%): ë“ì ë ¥, ì–´ì‹œìŠ¤íŠ¸
        - ë“œë¦¬ë¸” & ëŒíŒŒ (30%)
        - ì¸¡ë©´ í™œë™ (15%)
        - ì¼ê´€ì„± (10%)
        """
        num_matches = len(stats)

        # A. ê³¨ & ì°¬ìŠ¤ ì°½ì¶œ (45%)
        # ë“ì ë ¥
        total_goals = sum(s.get('goals', 0) for s in stats)
        goals_per_game = total_goals / num_matches if num_matches > 0 else 0

        total_shots = sum(s.get('shots', 0) for s in stats)
        shot_conversion = (total_goals / total_shots * 100) if total_shots > 0 else 0

        total_xg = sum(s.get('xg') or 0 for s in stats)
        goals_vs_xg = total_goals - total_xg if total_xg > 0 else 0

        scoring_score = min(100, (
            (goals_per_game / 0.7 * 50) +  # ê²½ê¸°ë‹¹ 0.7ê³¨ = 50ì 
            (shot_conversion / 22 * 30) +  # 22% ì „í™˜ìœ¨ = 30ì 
            (max(0, goals_vs_xg) * 5)
        ))

        # ì–´ì‹œìŠ¤íŠ¸
        total_assists = sum(s.get('assists', 0) for s in stats)
        total_crosses = sum(s.get('crosses', 0) for s in stats)
        total_cross_success = sum(s.get('cross_success', 0) for s in stats)
        cross_accuracy = (total_cross_success / total_crosses * 100) if total_crosses > 0 else 0

        total_key_passes = sum(s.get('key_passes', 0) for s in stats)

        assist_score = min(100, (
            (total_assists / num_matches * 80) +  # ê²½ê¸°ë‹¹ 0.5 ì–´ì‹œìŠ¤íŠ¸ = 40ì 
            (cross_accuracy / 30 * 40) +  # 30% ì •í™•ë„ = 40ì 
            (total_key_passes / num_matches / 2 * 20)  # ê²½ê¸°ë‹¹ 2ê°œ = 20ì 
        ))

        # B. ë“œë¦¬ë¸” & ëŒíŒŒ (30%)
        total_dribble_attempts = sum(s.get('dribble_attempts', 0) for s in stats)
        total_dribble_success = sum(s.get('dribble_success', 0) for s in stats)
        dribble_success_rate = (total_dribble_success / total_dribble_attempts * 100) if total_dribble_attempts > 0 else 0

        dribble_per_game = total_dribble_success / num_matches

        dribbling_score = min(100, (
            (dribble_success_rate / 55 * 60) +  # 55% ì„±ê³µë¥  = 60ì  (ìœ™ì–´ëŠ” ë” ë§ì´ ì‹œë„)
            (dribble_per_game / 5 * 40)  # ê²½ê¸°ë‹¹ 5íšŒ = 40ì 
        ))

        # C. ì¸¡ë©´ í™œë™ (15%)
        crosses_per_game = total_crosses / num_matches
        wing_activity_score = min(100, crosses_per_game / 6 * 100)  # ê²½ê¸°ë‹¹ 6íšŒ í¬ë¡œìŠ¤ = 100ì 

        # D. ì¼ê´€ì„± (10%)
        ratings = [s.get('rating', 7.0) for s in stats]
        rating_variance = statistics.variance(ratings) if len(ratings) > 1 else 0
        consistency_score = max(0, 100 - (rating_variance * 30))

        # ìµœì¢… ì¢…í•© ì ìˆ˜
        final_score = (
            scoring_score * 0.25 +
            assist_score * 0.20 +
            dribbling_score * 0.30 +
            wing_activity_score * 0.15 +
            consistency_score * 0.10
        )

        return {
            'position_score': round(final_score, 1),
            'breakdown': {
                'scoring_ability': {
                    'score': round(scoring_score, 1),
                    'goals': total_goals,
                    'goals_per_game': round(goals_per_game, 2),
                    'shot_conversion': round(shot_conversion, 1)
                },
                'assist_ability': {
                    'score': round(assist_score, 1),
                    'assists': total_assists,
                    'cross_accuracy': round(cross_accuracy, 1),
                    'key_passes': total_key_passes
                },
                'dribbling': {
                    'score': round(dribbling_score, 1),
                    'dribble_success_rate': round(dribble_success_rate, 1),
                    'successful_dribbles_per_game': round(dribble_per_game, 1)
                },
                'wing_activity': {
                    'score': round(wing_activity_score, 1),
                    'crosses_per_game': round(crosses_per_game, 1)
                },
                'consistency': {
                    'score': round(consistency_score, 1),
                    'rating_variance': round(rating_variance, 2)
                }
            },
            'key_strengths': cls._identify_winger_strengths(scoring_score, assist_score, dribbling_score),
            'areas_for_improvement': cls._identify_winger_weaknesses(scoring_score, assist_score, dribbling_score)
        }

    @classmethod
    def _identify_winger_strengths(cls, scoring: float, assist: float, dribbling: float) -> List[str]:
        strengths = []
        if scoring >= 80:
            strengths.append("âš¡ ê°•ë ¥í•œ ë“ì  ëŠ¥ë ¥")
        if assist >= 75:
            strengths.append("ğŸ¯ ë›°ì–´ë‚œ ì–´ì‹œìŠ¤íŠ¸ì™€ í¬ë¡œìŠ¤")
        if dribbling >= 80:
            strengths.append("ğŸ’¨ íƒì›”í•œ ë“œë¦¬ë¸” ëŒíŒŒ")
        return strengths if strengths else ["ìœ„í˜‘ì ì¸ ìœ™ì–´"]

    @classmethod
    def _identify_winger_weaknesses(cls, scoring: float, assist: float, dribbling: float) -> List[str]:
        weaknesses = []
        if scoring < 55:
            weaknesses.append("ë“ì ë ¥ í–¥ìƒ - ìŠˆíŒ… ì •í™•ë„ì™€ ë§ˆë¬´ë¦¬ ê°œì„ ")
        if assist < 55:
            weaknesses.append("ì–´ì‹œìŠ¤íŠ¸ ëŠ¥ë ¥ í–¥ìƒ - í¬ë¡œìŠ¤ ì •í™•ë„ í›ˆë ¨")
        if dribbling < 60:
            weaknesses.append("ë“œë¦¬ë¸” ì„±ê³µë¥  ê°œì„  - 1ëŒ€1 ëŒíŒŒ í›ˆë ¨")
        return weaknesses if weaknesses else []

    @classmethod
    def _empty_evaluation(cls) -> Dict[str, Any]:
        """ë¹ˆ í‰ê°€ ê²°ê³¼ ë°˜í™˜"""
        return {
            'position_score': 0,
            'breakdown': {},
            'key_strengths': [],
            'areas_for_improvement': ['ë°ì´í„° ë¶€ì¡±']
        }
